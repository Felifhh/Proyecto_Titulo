{% extends 'base.html' %}
{% load static %}

{% block title %}Gestión de Espacios Comunales{% endblock %}

{% block content %}

{% if messages %}
<div class="container mt-4 d-flex justify-content-center" style="border: 0cap;">
  <div class="col-md-8">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show shadow-sm text-center position-relative"
      role="alert">
      <i class="fa-solid fa-circle-info me-2"></i> {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>

      <!-- Barra de progreso -->
      <div class="alert-progress"></div>
    </div>
    {% endfor %}
  </div>
</div>
<script src="{% static 'js/mensaje.js' %}"></script>
{% endif %}

<div class="container my-4">
  <div class="p-4">
    <!-- Título + Acciones -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="text-light fw-bold mb-0">Gestión de Espacios Comunales</h3>

      <div class="d-flex align-items-center">
      <form method="get" class="d-flex">
        <input type="text" name="buscar" value="{{ query }}" placeholder="Buscar por Nombre..."
               class="form-control form-control-sm me-2" style="min-width:200px;">
        <button type="submit" class="btn btn-sm btn-outline-primary">Buscar</button>
      </form>

        <a href="{% url 'crear_espacio' %}" class="btn btn-success">
          <i class="fa-solid fa-plus"></i> Nuevo Espacio
        </a>
      </div>
    </div>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-3" id="espaciosTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="activos-tab" data-bs-toggle="tab" data-bs-target="#activos" type="button" role="tab">
          Activos
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="inactivos-tab" data-bs-toggle="tab" data-bs-target="#inactivos" type="button" role="tab">
          Desactivados
        </button>
      </li>
    </ul>

    <!-- Contenido de Tabs -->
    <div class="tab-content" id="espaciosTabsContent">

      <!-- Espacios Activos -->
      <div class="tab-pane fade show active" id="activos" role="tabpanel">
        <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
          <table class="table table-striped table-hover align-middle text-center table-dark">
            <thead>
              <tr>
                <th>Imagen</th>
                <th>Nombre</th>
                <th>Descripción</th>
                <th>Monto por Hora</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              {% for e in activos %}
              <tr>
                <td>
                  {% if e.imagen %}
                    <img src="{{ e.imagen.url }}" width="60" height="60" class="rounded" style="object-fit: cover;">
                  {% else %}
                    <img src="{% static 'img/placeholder.png' %}" width="60" height="60" class="rounded">
                  {% endif %}
                </td>
                <td>{{ e.nombre }}</td>
                <td>{{ e.descripcion|default:"-" }}</td>
                <td>${{ e.monto_hora }}</td>
                <td><span class="badge bg-success">Activo</span></td>
                <td>
                  <a href="{% url 'desactivar_espacio' e.id_espacio %}" class="btn btn-sm btn-warning">
                    <i class="fa-solid fa-ban"></i> Desactivar
                  </a>
                  <a href="{% url 'editar_espacio' e.id_espacio %}" class="btn btn-sm btn-primary">
                    <i class="fa-solid fa-pen"></i> Editar
                  </a>
                  <a href="{% url 'eliminar_espacio' e.id_espacio %}" class="btn btn-sm btn-danger">
                    <i class="fa-solid fa-trash"></i> Eliminar
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr><td colspan="6" class="text-center">No hay espacios activos.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Espacios Desactivados -->
      <div class="tab-pane fade" id="inactivos" role="tabpanel">
        <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
          <table class="table table-striped table-hover align-middle text-center table-dark">
            <thead>
              <tr>
                <th>Imagen</th>
                <th>Nombre</th>
                <th>Descripción</th>
                <th>Monto por Hora</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              {% for e in inactivos %}
              <tr>
                <td>
                  {% if e.imagen %}
                    <img src="{{ e.imagen.url }}" width="60" height="60" class="rounded" style="object-fit: cover;">
                  {% else %}
                    <img src="{% static 'img/placeholder.png' %}" width="60" height="60" class="rounded">
                  {% endif %}
                </td>
                <td>{{ e.nombre }}</td>
                <td>{{ e.descripcion|default:"-" }}</td>
                <td>${{ e.monto_hora }}</td>
                <td><span class="badge bg-secondary">Desactivado</span></td>
                <td>
                  <a href="{% url 'activar_espacio' e.id_espacio %}" class="btn btn-sm btn-success">
                    <i class="fa-solid fa-check"></i> Activar
                  </a>
                  <a href="{% url 'eliminar_espacio' e.id_espacio %}" class="btn btn-sm btn-danger">
                    <i class="fa-solid fa-trash"></i> Eliminar
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr><td colspan="6" class="text-center">No hay espacios desactivados.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </div>
</div>
{% endblock %}

