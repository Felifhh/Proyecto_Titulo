{% extends "base.html" %}
{% block title %}Detalle del Proyecto{% endblock %}

{% block content %}
<div class="container py-5">
  <h2 class="text-primary mb-4">
    <i class="fa-solid fa-folder-open me-2"></i>{{ proyecto.titulo }}
  </h2>

  <div class="card bg-dark text-light border-secondary p-4 shadow-sm">
    <p class="mb-3">{{ proyecto.descripcion }}</p>

    <p><strong>Presupuesto:</strong> {{ proyecto.presupuesto|default:"No especificado" }} CLP</p>
    <p><strong>Estado:</strong> {{ proyecto.estado }}</p>
    <p><strong>Estado de votación:</strong> {{ proyecto.estado_votacion }}</p>
    <p><strong>Fecha de postulación:</strong> {{ proyecto.fecha_postulacion|date:"d/m/Y H:i" }}</p>

    {% if proyecto.documento_adj %}
    <p>
      <strong>Documento adjunto: </strong>
      <a href="{{ proyecto.documento_adj.url }}" class="text-info" target="_blank">
        <i class="fa-solid fa-file-arrow-down me-1"></i>  Descargar archivo
      </a>
    </p>
    {% else %}
    <p><strong>Documento adjunto:</strong> No se adjuntó ningún archivo.</p>
    {% endif %}

    {% if proyecto.estado == "En Votación" %}
    <hr>
    <h5 class="text-success mb-3">Participa en la votación</h5>

    {% if ya_voto %}
    <p class="text-warning"><i class="fa-solid fa-circle-check me-1"></i>Ya emitiste tu voto para este proyecto.</p>
    {% else %}
    <div class="d-flex gap-3">
      <a href="{% url 'votar_proyecto' proyecto.id_proyecto 'favor' %}" class="btn btn-success">
        <i class="fa-solid fa-thumbs-up me-1"></i> Votar A Favor
      </a>
      <a href="{% url 'votar_proyecto' proyecto.id_proyecto 'contra' %}" class="btn btn-danger">
        <i class="fa-solid fa-thumbs-down me-1"></i> Votar En Contra
      </a>
    </div>
    {% endif %}

    <div class="mt-4">
      <p><strong>Votos a favor:</strong> {{ votos_a_favor }}</p>
      <p><strong>Votos en contra:</strong> {{ votos_en_contra }}</p>
    </div>

    {% elif proyecto.estado == "Finalizado" %}
    <hr>
    <h5 class="text-info">Resultado final</h5>
    <p><strong>Estado por votación:</strong> {{ proyecto.estado_votacion }}</p>
    <p><strong>Votos a favor:</strong> {{ votos_a_favor }}</p>
    <p><strong>Votos en contra:</strong> {{ votos_en_contra }}</p>
    {% endif %}

    <hr>
    <div class="mt-3 text-end">
      <a href="{% url 'proyectos_votacion' %}" class="btn btn-outline-light">
        <i class="fa-solid fa-arrow-left me-1"></i> Volver
      </a>
    </div>
  </div>
</div>
{% endblock %}